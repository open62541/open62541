name: Linux Build & Test with OpenSSL3.0

on: [push, pull_request]

jobs:
  build:
    strategy:
      fail-fast: false
      matrix:
        include: 
          - build_name: "Encryption (OpenSSL3.0) Build & Unit Tests (gcc)"
            cmd_deps: sudo apt-get install -y -qq openssl
            cmd_action: unit_tests_encryption OPENSSL
    name: ${{matrix.build_name}}
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/marwinglaser/ci:ubuntu-22.04
      options: --privileged
    steps:
    - uses: actions/checkout@v4
      with:
        submodules: true
    - name: Install Dependencies
      run: |
        sudo apt-get update
        sudo DEBIAN_FRONTEND=noninteractive apt-get install -y -qq cmake pkg-config libssl-dev python3-sphinx graphviz check
        ${{ matrix.cmd_deps }}
    - name: ${{matrix.build_name}}
      shell: bash
      run: source tools/ci.sh && ${{matrix.cmd_action}}
      env:
        ETHERNET_INTERFACE: eth0

